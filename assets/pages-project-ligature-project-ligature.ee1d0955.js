import{d as e,c as a,r as l,o as t,a as u,a8 as s,T as n,b as i,p as o,f as v,w as r,u as c,n as d,F as h,q as g,m as f,s as p,D as x,g as y,h as m,y as w,e as T,_ as b}from"./index-62c93e24.js";import{t as _}from"./index.03574bd1.js";import{a as X,b as Y}from"./uni-app.es.ba5b2566.js";const I=b(e({__name:"project-ligature",setup(e){let b=0,I=0,R=0,j=null,k=null;const F=16,S=a("ligature"),C=l({x:0,y:0}),E=l({x:0,y:0}),A=l(0),L=l(0),$=l(!1),q=l([]),D=l([]),N=l(0),O=l([]),P=l(!1);function W(){const e=O.value[L.value].cardOptionsList.map((e=>e.isRight));q.value=[],e.forEach((e=>{q.value.push({startX:j[e-1].left-F,startY:j[e-1].top-F,endX:j[e-1].left+j[e-1].width-F,endY:j[e-1].top+j[e-1].width-F,width:j[e-1].width})})),function(){$.value=!0,k&&clearInterval(k),S.clearRect(0,0,b,I);let e=0;k=setInterval((()=>{e<q.value.length?(D.value.push({x:q.value[e].startX+R/2,y:q.value[e].startY+R/2}),H("preview"),e+=1):(clearInterval(k),$.value=!1,S.clearRect(0,0,b,I),S.draw())}),800)}()}function z(e){if($.value)return;N.value=0;const a=e.touches[0];C.value.x=a.clientX-F,C.value.y=a.clientY-F;0==J(C.value)?(N.value++,D.value=[{x:q.value[0].startX+R/2,y:q.value[0].startY+R/2}]):(N.value=0,D.value=[])}X((e=>{var a;console.log(e),a=e.id,s(a).then((e=>{if(console.log(74,e),200==e.code){if(O.value=e.data,O.value.length){const e=parseInt(O.value[0].name.split("*")[0]);A.value=e*e,console.log(A.value)}n((()=>{u().selectAll(".ligature-box-item").boundingClientRect((e=>{R=e[0].width,j=e,W()})).exec()}))}}))})),t((()=>{u().select("#ligature-canvas").boundingClientRect((e=>{b=e.width,I=e.height})).exec()}));const B=_((function(e){if($.value)return;const a=e.touches[0];E.value.x=a.clientX-F,E.value.y=a.clientY-F,H(),function(){const e=J(E.value);if(e>0){N.value++;const a=q.value[e];D.value.push({x:a.startX+a.width/2,y:a.startY+a.width/2}),C.value.x=a.startX+a.width/2,C.value.y=a.startY+a.width/2}}()}),24);function G(){$.value||(N.value>=q.value.length-1?(N.value=0,uni.audioTipsSuccess.play(),P.value=!0):(p({title:"连的不对，再试试吧~",icon:"none"}),N.value=0,uni.audioTipsError.play()),D.value=[],S.clearRect(0,0,b,I),S.draw())}function H(e){if(S.setStrokeStyle("#FFAC02"),S.setLineWidth(6),S.clearRect(0,0,b,I),S.beginPath(),D.value.length>1){S.moveTo(D.value[0].x,D.value[0].y);for(let e=1;e<D.value.length;e++)S.lineTo(D.value[e].x,D.value[e].y);S.stroke()}e&&"preview"===e||(S.moveTo(C.value.x,C.value.y),S.lineTo(E.value.x,E.value.y),S.stroke()),S.draw()}function J(e){if(q.value&&q.value.length){const a=q.value.findIndex((a=>e.x>=a.startX&&e.x<=a.endX&&e.y>=a.startY&&e.y<=a.endY));return-1!==a&&a==N.value?a:0===a&&N.value===q.value.length-1?q.value.length-1:-1}return-1}function K(){L.value<O.value.length-1?(L.value+=1,W(),P.value=!1):(p({title:"恭喜您，已全部完成~"}),setTimeout((()=>{x({url:"/pages/game-pass/game-pass"})}),1e3))}return Y((()=>{k=null,clearInterval(k)})),(e,a)=>{const l=y,t=m,u=w("TipsSuccess");return i(),o(h,null,[v(l,{class:"box"},{default:r((()=>[v(l,{class:"ligature",onTouchstart:z,onTouchmove:c(B),onTouchend:G},{default:r((()=>[v(l,{class:d(["ligature-box",`grid${A.value}`])},{default:r((()=>[(i(!0),o(h,null,g(A.value,(e=>(i(),T(l,{class:"ligature-box-item",id:`box${e}`,key:e},{default:r((()=>[f("●")])),_:2},1032,["id"])))),128))])),_:1},8,["class"]),v(l,{class:"ligature-canvas-box"},{default:r((()=>[v(t,{"canvas-id":"ligature",id:"ligature-canvas",style:{width:"100%",height:"100%"}})])),_:1})])),_:1},8,["onTouchmove"])])),_:1}),v(l,{class:"tips"},{default:r((()=>[f(" 请按照提示画线顺序依次链接各个点 ")])),_:1}),v(u,{show:P.value,onNext:K},null,8,["show"])],64)}}}),[["__scopeId","data-v-24739766"]]);export{I as default};
